\documentclass[a1,landscape]{sciposter}
\setmargins[1cm]

\usepackage{csvsimple}	% for marker and target positions
\usepackage{readarray}	% for key=value settings file

\usepackage{siunitx}
\sisetup{detect-all}

\usepackage{tikz}

% much of the poster setup is read from the file validationSetup.txt. NB: distance in there is in cm, gridCols, gridRows and markerSide are in degrees visual angle
% setup look
\def\useExactTobiiSize{0}
\def\showGrid{0}
\def\showAnnotations{1}

% read setup
\readdef{validationSetup.txt}{\fileData}
\readarray\fileData\setupInfo[-,3]
% turn each key into its own command
\newcounter{keyCount}
\setcounter{keyCount}{0}%
\whiledo{\value{keyCount} < \setupInfoROWS}{%
	\stepcounter{keyCount}%
	\expandafter\xdef\csname \setupInfo[\arabic{keyCount},1]\endcsname{%
		\setupInfo[\arabic{keyCount},3]}%
}
\def\markerSideCm{\markerSide\step}
\def\markerFilename#1{all-markers/#1.png}

\makeatletter
\def\convertto#1#2{\strip@pt\dimexpr #2*65536/\number\dimexpr 1#1}
\makeatother

% 2*tan(angle/2)*distance
\pgfmathparse{(2*tan(.5)*\distance)}
\edef\gridFac{\pgfmathresult}
\newlength{\step}
\setlength{\step}{\gridFac cm}

\pgfmathparse{(\distance/100)}
\edef\distanceMeter{\pgfmathresult}

% setup gaze targets
\if\useExactTobiiSize1
	% exact size specifications of Tobii calibration target
	\newcommand{\tobii}[3]{
		\fill[white] (#1-27.25mm,#2-27.25mm) rectangle (#1+27.25mm,#2+27.25mm);
		\draw[fill=#3]    (#1,#2) circle (21.5mm);
		\draw[fill=white] (#1,#2) circle (11.5mm);
		\draw[fill=#3]    (#1,#2) circle (1.5mm);
	}
\else
	% instead, something defined in visual angle that looks good
	\newcommand{\tobii}[3]{
		\fill[white] (#1-1\step,#2-1\step) rectangle (#1+1\step,#2+1\step);
		\draw[fill=#3]    (#1,#2) circle (.8\step);
		\draw[fill=white] (#1,#2) circle (.43\step);
		\draw[fill=#3]    (#1,#2) circle (.055\step);
	}
\fi


\begin{document}

\centering
\begin{tikzpicture}[
		draw,color=black!30
	]
	\if\showGrid1
		\draw[step=\step, line width=3pt] (0cm,0cm) grid (\step*\gridCols,\step*\gridRows);
	\fi
	
\csvreader[no head]{\markerPosFile}{1=\ID, 2=\x, 3=\y}%
{
	\coordinate (m) at (
	\x*\step,
	\y*\step
	);
	
	\node[inner sep=0pt] (m2) at (m)			{\includegraphics[width=\markerSideCm]{\markerFilename{\ID}}};
};


\csvreader[no head]{\targetPosFile}{1=\ID, 2=\x, 3=\y, 4=\tColor}%
{
	\tobii{\x*\step}{\y*\step}{\tColor};
};


	
	% annotations
	\if\showAnnotations1
		\node[left] at (-0\step, 1\step-0.5\step)     { 1 };
		\node[left] at (-0\step, \gridRows\step-0.5\step) { \gridRows };
	
		\node[] at (1\step-0.5\step    ,-0.5\step) { 1 };
		\node[] at (\gridCols\step-0.5\step,-0.5\step) { \gridCols };
	
		\node[right] at (5\step,-0.5\step) {
			Grid: \SI{\gridCols}{\degree} x \SI{\gridRows}{\degree}
		};
		\node[right] at (5\step,-0.5\step-1cm) {
			Cell: \SI{\convertto{cm}{\step}}{\centi\meter} x
			      \SI{\convertto{cm}{\step}}{\centi\meter}
		};
		\node[right] at (5\step,-0.5\step-2cm) {
			1 cell = \SI{1}{\degree} at \SI{\distanceMeter}{\meter}
		};
	\fi


\end{tikzpicture}

\end{document}
